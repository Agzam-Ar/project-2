# Фиксированная точка

> Способ представления вещественных чисел в цифровых системах, где положение десятичной (или двоичной) точки заранее фиксировано и не меняется в процессе вычислений.

### Формат представления 

В **n-разрядной сетке** точка фиксируется между **k** и **(n-k)** разрядами.  
  - **Целая часть** занимает **(n−k)** старших разрядов.  
  - **Дробная часть** занимает **k** младших разрядов.  

---
## Масштабирование

> Числа с фиксированной точкой хранятся как **целые** (`int`), но интерпретируются как **дробные**.  
   Масштабирование определяет, **как биты целого числа соответствуют реальному значению**

**Почему без масштабирования нельзя?**
Если просто хранить `float` как `int`, то:  
- **Дробная часть потеряется** (например, `3.14` → `3`).  
- **Нельзя представить малые числа** (например, `0.001`).  
- **Арифметика будет некорректной** (умножение даст неверный результат).  

> Чтобы удобнее работать с числами, вводится **масштабный множитель** $M = 2^m$, где $m ∈ ℤ$ (целое число).  
> 
> Число $x$ представляется в виде:  
> $x = y * M$,  
> где $y$ — целое или дробное число, хранящееся в памяти.  

### Целое масштабирование

- $y$ — целое число.  
- Разрядная сетка хранит **целую часть**, а дробная подразумевается.  
- Масштаб $M = 2^{-k}$.  

**Пример (16 бит, $M = 2^{-5}$):**  

`x = 10111.1011` → `y = 1011110110.0` → в памяти: `0000001011110110`.  

---
## Погрешность представления

При **целом масштабировании**:  

- **Абсолютная погрешность** — половина "цены младшего разряда":  
  $Δ = M/2 = 2^{-(k+1)}$  
  (например, при $k=5 → Δ = 2⁻⁶ ≈ 0.015625$).  

- **Относительная погрешность** зависит от величины числа:  
  - **Максимальная** (когда |x| минимально, например, 1)м 
  - **Минимальная** (когда |x| максимально, например, 2ⁿ⁻¹):   

**Вывод:**  
- Абсолютная погрешность **постоянна**.  
- Относительная погрешность **сильно зависит от величины числа**.  

---

## Особенности арифметических операций

### Сложение и вычитание

1. **Одинаковый формат обязателен**  
   - Оба числа должны иметь **одинаковое количество дробных бит (n)**.  
   - Если форматы разные → требуется **нормализация** (сдвиг одного из чисел).  

2. **Переполнение разрядной сетки**  
   - Результат может выйти за допустимый диапазон.  
   - **Пример (Q1.3, 4 бита):**  
     - Максимальное число = `1.875` (`0111`).  
     - `1.0 + 1.0 = 2.0` → переполнение (в Q1.3 это `-2.0`).  
### Умножение

1. **Удвоение дробных бит**  
   - Если множители в формате `Qm.n`, результат будет в `Q(2m).(2n)`.  
   - **Пример:**  
     - `Q1.3 * Q1.3 = Q2.6` (нужен сдвиг вправо на `n=3`).  

2. **Потеря точности при сдвиге**  
   - После умножения нужно **сдвигать результат вправо** на `n` бит.  
   - Младшие биты отбрасываются → возможна погрешность.  

3. **Переполнение**  
   - Произведение двух `N`-битных чисел требует `2N` бит.  
   - **Пример (Q1.3):**  
     - `1.5 * 1.5 = 2.25` → в `Q2.6` это корректно, но в `Q1.3` будет переполнение.  
### Деление

1. **Сложность реализации**  
   - Требует **нормализации** и **коррекции масштаба**.  

2. **Потеря точности**  
   - Результат деления целых чисел часто **усекается**.  
   - **Пример (Q1.3):**  
   - `1.0 / 3.0 ≈ 0.333` → в `Q1.3` это `0.375` (погрешность).  
---

## Проверь себя

#### Что характеризует формат представления чисел с фиксированной точкой?
``` quiz
- Плавающее положение точки в разрядной сетке
+ Жестко фиксированное положение точки между k и (k-1) разрядами
- Автоматическое изменение положения точки при операциях
- Использование только целых чисел без дробной части
```
#### Почему необходимо масштабирование при работе с фиксированной точкой?
``` quiz
- Для уменьшения разрядности чисел
- Для автоматической коррекции положения точки
- Только для ускорения вычислений
+ Чтобы представлять дробные числа через целочисленные значения
```
#### Какое преобразование выполняется при целом масштабировании?
``` quiz
- Число умножается на 2ⁿ
+ Число делится на 2ⁿ
- Дробная часть отбрасывается
- Точка перемещается в старшие разряды
```
#### Как вычисляется абсолютная погрешность представления?
``` quiz
+ Δ = 2⁻⁽ᵏ⁺¹⁾
- Δ = 2⁻ᵏ
- Δ = 2ᵏ
- Δ = M
```
#### Какое главное требование для операции сложения?
``` quiz
- Разные форматы чисел
- Использование плавающей точки
+ Одинаковое количество дробных бит
- Разная разрядность операндов
```
#### Как избежать переполнения при операциях?
``` quiz
+ Увеличивать разрядность для промежуточных результатов
- Всегда использовать насыщение
- Игнорировать проблему
- Переходить на плавающую точку
```

